<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>Articles</title>
    

  </head>
    
  <body>
  <html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Articles — Voices of Strength</title>

<style>
  :root{--brown:#3B2A1E;--cream:#E9DBC6}
  *{box-sizing:border-box}
  body{margin:0;font-family:"Times New Roman", serif;background:var(--brown);color:var(--cream)}
  .site-header{background:var(--cream);color:var(--brown);padding:22px 28px;display:flex;align-items:center;justify-content:space-between;border-bottom:8px solid rgba(0,0,0,0.04);position:sticky;top:0;z-index:20}
  .brand{font-size:38px;letter-spacing:2px;font-weight:400}
  .nav{display:flex;gap:22px;align-items:center}
  .nav a{color:var(--brown);text-decoration:none;font-size:16px}
  .container{max-width:1100px;margin:26px auto;padding:0 24px 120px}
  .banner{background:#4a2f29;height:180px;border-radius:2px;overflow:hidden;margin-bottom:18px;display:flex;align-items:center;justify-content:center}
  .banner img{width:100%;height:100%;object-fit:cover}
  .title-row{color:var(--cream);margin:20px 0 10px}
  .page-title{font-size:40px;font-weight:700;color:var(--cream);margin:0 0 6px}
  .meta{color:#d4beb0;font-size:14px}
  .divider-hr{border:none;border-top:1px solid rgba(255,255,255,0.08);margin:18px 0 28px}
  .share-wrap{border:1px solid rgba(255,255,255,0.06);padding:18px;display:flex;gap:16px;align-items:center;margin-bottom:28px}
  .share-input{flex:1;padding:14px 16px;background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--cream);border-radius:2px;font-size:16px}
  .send-btn{width:140px;background:var(--cream);color:var(--brown);font-size:20px;padding:12px 18px;border:none;cursor:pointer;border-radius:2px;font-family:"Times New Roman", serif}
  .post-card{border:1px solid rgba(255,255,255,0.06);padding:22px;margin-bottom:26px;background:transparent;position:relative}
  .post-header{display:flex;align-items:center;gap:14px}
  .avatar{width:54px;height:54px;border-radius:50%;overflow:hidden;border:2px solid rgba(255,255,255,0.06)}
  .avatar img{width:100%;height:100%;object-fit:cover}
  .post-author{font-size:18px;font-weight:700;color:var(--cream)}
  .post-time{font-size:13px;color:#e3cfcf}
  .post-title{font-size:22px;margin:14px 0 12px;color:var(--cream)}
  .post-body{color:#f0d9d9;line-height:1.8;font-size:16px}
  .post-actions{display:flex;gap:10px;align-items:center;margin-top:14px}
  .like-btn{display:flex;gap:10px;align-items:center;cursor:pointer;border:none;background:transparent;color:var(--cream);font-size:15px}
  /* single-line comment style to match screenshot */
  .comment-line { display:flex; align-items:center; gap:12px; margin-top:16px; }
  .heart { font-size:18px; color:var(--cream); flex:0 0 22px; user-select:none; cursor:pointer; }
  .comment-input{flex:1;padding:10px 14px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--cream);border-radius:2px}
  .comment-send { background:var(--cream); color:var(--brown); border:none; padding:8px 16px; cursor:pointer; }
  .comments-list{margin-top:12px}
  .comment-item{margin-top:10px;padding:10px;border-left:3px solid rgba(255,255,255,0.03);color:#f0d9d9}
  .comment-author{font-weight:700;color:var(--cream);margin-right:8px}
  .site-footer{margin-top:44px;background:var(--cream);color:var(--brown);padding:36px 20px}
  .footer-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;max-width:1100px;margin:0 auto;text-align:center}
  .footer-grid p{font-size:14px;margin:6px 0;line-height:1.6;color:var(--brown)}
  .post-menu{position:absolute;top:20px;right:20px;cursor:pointer}
  .dots{font-size:22px;color:var(--cream);line-height:1}
  .menu-dropdown{display:none;flex-direction:column;position:absolute;top:30px;right:0;background:var(--cream);padding:8px;border-radius:6px;box-shadow:0 6px 18px rgba(0,0,0,0.15);z-index:50}
  .menu-dropdown button{background:transparent;border:none;padding:6px 10px;color:var(--brown);font-weight:700;cursor:pointer;text-align:left}
  .menu-dropdown button:hover{background:#efe9e6}
  @media (max-width:760px){.page-title{font-size:28px}.banner{height:140px}.footer-grid{grid-template-columns:1fr;text-align:left}}
</style>
</head>
<body>

<header class="site-header">
  <div class="brand">PEN &amp; GAVEL</div>
  <nav class="nav">
    <li><a href="../index.html">Home</a></li>
    <li><a href="about.html">About</a></li>
<li><a href="constitutional-articles.html">Constitutional Articles</a></li>
<li><a href="past-cases.html">Past Cases</a></li>
<li><a href="literary.html">Literary Works</a></li>
<li><a href="legislation.html">Legislation</a></li>
  </nav>
</header>

<main class="container">
  <!-- use the article banner image you provided -->
  <div class="banner"><img src="https://i.ibb.co/Jj3QTHhy/article.jpg" alt="Articles banner"></div>

  <section class="title-row">
    <h1 class="page-title">Articles — Voices of Strength ✦</h1>
    <div class="meta">Public</div>
    <hr class="divider-hr">
  </section>

  <section class="share-wrap" aria-label="Share something">
    <input class="share-input" id="shareText" placeholder="Share something..." />
    <button class="send-btn" id="shareBtn">send</button>
  </section>

  <section id="postsContainer"></section>
</main>

<footer class="site-footer">
  <div class="footer-grid">
    <div><p>7827170170 - NCW Helpline:<br>Connects women directly to police, hospitals, One Stop Centres, and legal authorities for safety, support, and protection in emergencies or personal crises.</p></div>
    <div><p>1091 - Women Police Helpline:<br>Provides immediate police assistance to women in distress and linked to the national Emergency Response Support System (ERSS 112).</p></div>
    <div><p>108 - Ambulance Helpline:<br>Offers quick access to ambulance and medical emergency services across India.</p></div>

    <div><p>181 - Women Helpline:<br>A 24x7 helpline offering emergency response, counselling, legal guidance, and information on government welfare schemes for women.</p></div>
    <div><p>112 - National Emergency Number:<br>A single, all-India emergency number for police, fire, and ambulance services.</p></div>
    <div><p>We'd love to hear from you.<br>Connect with us at:<br><strong>penandgavel.official@gmail.com</strong></p></div>
  </div>
</footer>

<!-- FIREBASE + APP LOGIC (Realtime DB) -->
<script type="module">
  // ----- REPLACE THESE VALUES (only) -----
  const firebaseConfig = {
    apiKey: "AIzaSyC4Yjfr1WqoM-PmEQxHq-Sj2BTQvmoBOkk",
        authDomain: "penandgavelposts.firebaseapp.com",
        databaseURL: "https://penandgavelposts-default-rtdb.firebaseio.com/",
        projectId: "penandgavelposts",
        storageBucket: "penandgavelposts.firebasestorage.app",
        messagingSenderId: "1094706446735",
        appId: "1:1094706446735:web:0d86c105c86ba51ab20bfa"
  };
  // ---------- IMPORTS (same style as poems.html) ----------
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
  import {
    getDatabase,
    ref,
    push,
    onValue,
    set,
    get,
    update,
    runTransaction,
    remove
  } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

  // ---------- INIT ----------
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getDatabase(app);

  // ---------- ELEMENTS ----------
  const postsContainer = document.getElementById("postsContainer");
  const shareInput = document.getElementById("shareText");
  const shareBtn = document.getElementById("shareBtn");

  let currentUser = null;

  // ---------- HELPERS ----------
  function formatDate(ts){ if(!ts) return ""; return new Date(Number(ts)).toLocaleString(); }
  function esc(s){ return String(s || ""); }

  // ---------- AUTH PROTECTION & START ----------
  onAuthStateChanged(auth, (user) => {
    if (!user) {
      // keep same redirect flow as poems: save where to come back after login
      localStorage.setItem("redirectAfterLogin", location.href);
      // change this to your login CodePen full URL if needed
      window.location.href = "../login/index.html";
      return;
    }
    currentUser = user;
    // ensure sample article exists, then attach listeners
    ensureSampleArticle().then(setupRealtimeListeners).catch(e=>console.error(e));
  });

  // ---------- SAMPLE ARTICLE (created once) ----------
  async function ensureSampleArticle(){
    const sampleRef = ref(db, "articles/sample_article");
    const snap = await get(sampleRef);
    if (snap.exists()) return;
    const payload = {
      id: "sample_article",
      authorName: "Pen&Gavel",
      authorUid: null,
      authorAvatar: "https://i.ibb.co/m5xLPmHZ/Corporate-Logo-Designs-Logo-Image-1.jpg",
      createdAt: Date.now(),
      likesCount: 0,
      likedBy: {},
      content: `This is a space for women to share their thoughts, ideas, and reflections on the world around them. Whether you wish to write about empowerment, society, or simple moments of everyday grace – your words are welcome here. Let your voice flow with honesty and heart, and let it inspire others to think, feel, and grow.`
    };
    await set(sampleRef, payload);
  }

  // ---------- CREATE ARTICLE ----------
  async function createArticle(text){
    if(!currentUser) return alert("You must be logged in to post.");
    if(!text || !text.trim()) return;
    const articlesRef = ref(db, "articles");
    const newRef = push(articlesRef);
    const payload = {
      id: newRef.key,
      authorName: currentUser.displayName || currentUser.email || "Unknown",
      authorUid: currentUser.uid,
      authorAvatar: currentUser.photoURL || "https://i.ibb.co/m5xLPmHZ/Corporate-Logo-Designs-Logo-Image-1.jpg",
      createdAt: Date.now(),
      likesCount: 0,
      likedBy: {},
      content: text.trim()
    };
    await set(newRef, payload);
    shareInput.value = "";
  }

  // ---------- TOGGLE LIKE (transaction) ----------
  async function toggleLike(articleId){
    if(!currentUser) return alert("Login to like.");
    const postRef = ref(db, `articles/${articleId}`);
    try{
      await runTransaction(postRef, (post) => {
        if(!post) return post;
        post.likedBy = post.likedBy || {};
        const uid = currentUser.uid;
        if(post.likedBy[uid]){
          post.likedBy[uid] = null;
          post.likesCount = (post.likesCount || 1) - 1;
        } else {
          post.likedBy[uid] = true;
          post.likesCount = (post.likesCount || 0) + 1;
        }
        return post;
      });
    }catch(e){ console.error("like tx err", e); }
  }

  // ---------- ADD COMMENT ----------
  async function addComment(articleId, text){
    if(!currentUser) return alert("Login to comment.");
    if(!text || !text.trim()) return;
    const commentsRef = ref(db, `articles/${articleId}/comments`);
    const newRef = push(commentsRef);
    await set(newRef, {
      authorName: currentUser.displayName || currentUser.email || "Unknown",
      authorUid: currentUser.uid,
      text: text.trim(),
      createdAt: Date.now()
    });
  }

  // ---------- EDIT / DELETE ----------
  async function deleteArticle(articleId){
    if(!currentUser) return alert("Login required.");
    const snap = await get(ref(db, `articles/${articleId}`));
    if(!snap.exists()) return alert("Not found");
    const data = snap.val();
    if(data.authorUid !== currentUser.uid && data.authorName !== (currentUser.displayName || currentUser.email)){
      return alert("You are not the author.");
    }
    if(!confirm("Delete this article?")) return;
    await remove(ref(db, `articles/${articleId}`));
  }
  async function editArticle(articleId){
    if(!currentUser) return alert("Login required.");
    const snap = await get(ref(db, `articles/${articleId}`));
    if(!snap.exists()) return alert("Not found");
    const data = snap.val();
    if(data.authorUid !== currentUser.uid && data.authorName !== (currentUser.displayName || currentUser.email)){
      return alert("You are not the author.");
    }
    const newText = prompt("Edit article content:", data.content || "");
    if(newText === null) return;
    await update(ref(db, `articles/${articleId}`), { content: newText, editedAt: Date.now() });
  }

  // ---------- RENDER ARTICLE ELEMENT ----------
  function createArticleElement(article){
    const id = article.id;
    const wrapper = document.createElement("div");
    wrapper.className = "post-card";
    wrapper.dataset.id = id;

    // menu + header
    const menuWrap = document.createElement("div");
    menuWrap.className = "post-menu";
    menuWrap.innerHTML = `
      <div class="dots">⋮</div>
      <div class="menu-dropdown" aria-hidden="true" style="display:none;flex-direction:column">
        <button class="menu-edit">Edit</button>
        <button class="menu-delete">Delete</button>
      </div>
    `;

    const header = document.createElement("div");
    header.className = "post-header";
    header.innerHTML = `
      <div class="avatar"><img src="${esc(article.authorAvatar)}" alt="avatar" /></div>
      <div>
        <div class="post-author">${esc(article.authorName)}</div>
        <div class="post-time">${formatDate(article.createdAt)}</div>
      </div>
    `;

    const body = document.createElement("div");
    body.innerHTML = `<div class="post-title">Voices of Strength</div><div class="post-body">${esc(article.content)}</div>`;

    // actions row
    const footer = document.createElement("div");
    footer.className = "post-actions";

    const heart = document.createElement("div");
    heart.className = "heart";
    heart.textContent = "♡";
    heart.title = "Like";
    heart.style.cursor = "pointer";
    heart.onclick = () => toggleLike(id);

    const likesSpan = document.createElement("div");
    likesSpan.className = "likes-count";
    likesSpan.style.color = "#d4beb0";
    likesSpan.style.marginLeft = "6px";
    likesSpan.textContent = `${article.likesCount || 0} likes`;

    // comment line
    const commentLineWrap = document.createElement("div");
    commentLineWrap.className = "comment-line";
    commentLineWrap.innerHTML = `<div class="heart" aria-hidden="true">♡</div><div class="comment-line-inner" style="flex:1"><input class="comment-input" placeholder="Write a comment..." /></div>`;

    const commentInputEl = commentLineWrap.querySelector(".comment-input");
    // send button (match share theme but smaller)
    const commentSend = document.createElement("button");
    commentSend.className = "comment-send";
    commentSend.textContent = "send";
    commentSend.onclick = () => { addComment(id, commentInputEl.value); commentInputEl.value = ""; };

    // comments area
    const commentsArea = document.createElement("div");
    commentsArea.className = "comments-list";

    // menu actions
    const menuDropdown = menuWrap.querySelector(".menu-dropdown");
    menuWrap.querySelector(".menu-edit").onclick = () => editArticle(id);
    menuWrap.querySelector(".menu-delete").onclick = () => deleteArticle(id);

    // toggle dropdown on dots click
    menuWrap.querySelector(".dots").addEventListener("click", (e) => {
      e.stopPropagation();
      menuDropdown.style.display = menuDropdown.style.display === "flex" ? "none" : "flex";
    });
    // close dropdown on outside click
    document.addEventListener("click", ()=>{ menuDropdown.style.display = "none"; });

    // assemble
    wrapper.appendChild(menuWrap);
    wrapper.appendChild(header);
    wrapper.appendChild(body);

    const actionRow = document.createElement("div");
    actionRow.style.display = "flex";
    actionRow.style.alignItems = "center";
    actionRow.style.gap = "12px";
    actionRow.style.marginTop = "16px";
    actionRow.appendChild(heart);
    actionRow.appendChild(likesSpan);
    actionRow.appendChild(commentLineWrap);
    actionRow.appendChild(commentSend);

    wrapper.appendChild(actionRow);
    wrapper.appendChild(commentsArea);

    // realtime listeners for this article (likes & author check)
    onValue(ref(db, `articles/${id}`), (snap)=>{
      const d = snap.val();
      if(!d) return;
      likesSpan.textContent = `${d.likesCount || 0} likes`;
      const uid = currentUser ? currentUser.uid : null;
      if(uid && d.likedBy && d.likedBy[uid]) heart.textContent = "❤";
      else heart.textContent = "♡";

      // menu visibility only for author
      const isAuthor = currentUser && (d.authorUid === currentUser.uid || d.authorName === (currentUser.displayName || currentUser.email));
      menuWrap.style.display = isAuthor ? "block" : "none";
    });

    // realtime comments
    onValue(ref(db, `articles/${id}/comments`), (snap)=>{
      commentsArea.innerHTML = "";
      const val = snap.val() || {};
      const keys = Object.keys(val).sort((a,b)=> (val[a].createdAt||0) - (val[b].createdAt||0));
      keys.forEach(k=>{
        const c = val[k];
        const el = document.createElement("div");
        el.className = "comment-item";
        el.innerHTML = `<strong class="comment-author">${esc(c.authorName)}</strong> ${esc(c.text)}<div style="font-size:12px;color:#d4beb0;margin-top:6px">${formatDate(c.createdAt)}</div>`;
        commentsArea.appendChild(el);
      });
    });

    return wrapper;
  }

  // ---------- realtime feed listener (articles) ----------
  function setupRealtimeListeners(){
    onValue(ref(db, "articles"), (snap) => {
      const val = snap.val() || {};
      const items = Object.values(val).sort((a,b)=> (b.createdAt||0)-(a.createdAt||0));
      postsContainer.innerHTML = "";
      items.forEach(item=>{
        const el = createArticleElement(item);
        postsContainer.appendChild(el);
      });
    });
  }

  // ---------- UI events ----------
  shareBtn.addEventListener("click", ()=> createArticle(shareInput.value));
  shareInput.addEventListener("keydown", (e)=> { if(e.key === "Enter"){ e.preventDefault(); createArticle(shareInput.value); } });

  // end module
</script>
  <script type="text/javascript">
  (function(d, t) {
      var v = d.createElement(t), s = d.getElementsByTagName(t)[0];
      v.onload = function() {
        window.voiceflow.chat.load({
          verify: { projectID: '69077c8c2c2c409d8b3aa75d' },
          url: 'https://general-runtime.voiceflow.com',
          versionID: 'production',
          voice: {
            url: "https://runtime-api.voiceflow.com"
          }
        });
      }
      v.src = "https://cdn.voiceflow.com/widget-next/bundle.mjs"; v.type = "text/javascript"; s.parentNode.insertBefore(v, s);
  })(document, 'script');
</script>
</body>
</html>
    
  </body>
  
</html>
